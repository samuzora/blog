<% let ctfs = site.data.ctfs.sort((a, b) => b.date - a.date).map(ctf => ({ name: ctf.name, date: ctf.date, rank: ctf.rank, url: ctf.url, year: date(ctf.date, 'YYYY') })) %>
<% let ctfsByYear = ctfs.reduce((acc, ctf) => { %>
    <% if (acc.hasOwnProperty(ctf.year)) { %>
        <% acc[ctf.year].push(ctf) %>
    <% } else { %>
        <% acc[ctf.year] = [ctf] %>
    <% } %>
    <% return acc %>
<% }, {}) %>

<div class="ctf-list-container px-2 sm:px-6 md:px-8 pb-8">
    <h1 class="text-3xl font-bold mb-4">CTF timeline</h1>
    <% Object.keys(ctfsByYear).reverse().map(year => { %>
        <details class="ctf" data-header-exclude>
            <summary>
              <i class="fa-solid fa-chevron-right"></i>
              <div class="ctf-header">
                  <span class="ctf-year"><%= year %></span>
                  <span class="ctf-year-count">[<%= ctfsByYear[year].length %>]</span>
              </div>
            </summary>
            <ul class="ctf-list">
              <% ctfsByYear[year].map(ctf => { %>
                <li class="ctf-item" date-is='<%= date(ctf.date, 'MM-DD') %>'>
                  <% if (ctf.url) { %>
                    <a href="<%= ctf.url %>" class="ctf-title">
                      <%= ctf.name %>
                      <span class="fa-solid fa-external-link" aria-hidden="true"></span>
                    </a>
                  <% } else { %>
                    <span class="ctf-title"><%= ctf.name %></span>
                  <% } %>
                  <% if (ctf.rank) { %>
                    <% if (ctf.rank.includes("1st")) { %>
                      <div class="ctf-placing ctf-placing-1st"><%= ctf.rank %></div>
                    <% } else if (ctf.rank.includes("2nd")) { %>
                        <div class="ctf-placing ctf-placing-2nd"><%= ctf.rank %></div>
                    <% } else if (ctf.rank.includes("3rd")) { %>
                        <div class="ctf-placing ctf-placing-3rd"><%= ctf.rank %></div>
                    <% } else { %>
                        <div class="ctf-placing"><%= ctf.rank %></div>
                      <% } %>
                  <% } %>
                </li>
              <% }) %>
            </ul>
        </details>
    <% }) %>
</div>
